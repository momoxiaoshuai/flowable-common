import{u as I,a as _,o as T,r as c,h as q,b as v,c as j,d as g,e as s,w as i,f as E,g as l,D as w,t as M,j as h,k as P,F as O}from"./index-B-OkF-Vi.js";import{M as $,E as G}from"./el-card-C16-ePu9.js";import{E as K,a as z}from"./el-form-item-DkIAkhZe.js";import{E as A}from"./el-text-Zmud3bxF.js";import{E as H}from"./el-input-kTMZ2gCf.js";import{_ as J,D as Q,F as W,G as Y,E as Z}from"./_plugin-vue_export-helper--f4TL7q-.js";const ee={class:"btn"},te={class:"card-header"},oe={__name:"edit",setup(ne){const b=I(),r=_({value:"",type:"edit"});T(()=>{b.query.id?r.value=b.query.id:(r.value=Math.random().toString(36).substring(2,10)+Math.random().toString(36).substring(2,10),r.type="create"),V()});const y=c(null);let d=c(null);const V=async()=>{d.value=new $({container:y.value}),B()},x=c(""),B=async()=>{let t;if(r.type==="create")t=`<?xml version="1.0" encoding="UTF-8"?>
                  <definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:flowable="http://flowable.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" typeLanguage="http://www.w3.org/2001/XMLSchema" expressionLanguage="http://www.w3.org/1999/XPath" targetNamespace="http://www.flowable.org/processdef" exporter="Flowable Open Source Modeler" exporterVersion="6.7.2">
                  <process id="${r.value}" name="1" isExecutable="true">
                      <documentation>1</documentation>
                      <startEvent id="startEvent1" flowable:formFieldValidation="true"></startEvent>
                  </process>
                  <bpmndi:BPMNDiagram id="BPMNDiagram_a1">
                      <bpmndi:BPMNPlane bpmnElement="a1" id="BPMNPlane_a1">
                      <bpmndi:BPMNShape bpmnElement="startEvent1" id="BPMNShape_startEvent1">
                          <omgdc:Bounds height="30.0" width="30.0" x="100.0" y="163.0"></omgdc:Bounds>
                      </bpmndi:BPMNShape>
                      </bpmndi:BPMNPlane>
                  </bpmndi:BPMNDiagram>
                  </definitions>`;else{const{data:e}=await Q({processDefinitionKey:r.value});t=e.xml,x.value=e.name}await d.value.importXML(t),S()},k=q(),D=async()=>{const{xml:t}=await d.value.saveXML({format:!0});console.log(t);const e={key:r.value,xml:window.btoa(unescape(encodeURIComponent(t)))};r.type==="edit"?await W(e):await Y(e),k.back()},N=c([]),a=c(),o=_({key:"",name:"",description:"",user:"",type:"",condition:""}),S=()=>{d.value.on("selection.changed",t=>{var e;if((e=t.newSelection)!=null&&e.length)N.value=t.newSelection,a.value=t.newSelection[0];else{console.log("no element selected");const m=d.value.get("elementRegistry").get(r.value);a.value=m}F()}),d.value.on("element.changed",t=>{const{element:e}=t;a&&e.id===a.id&&(a.value=e)})},F=()=>{var e;if(!a.value)return;const{businessObject:t}=a.value;console.log(a.value),o.key=t.id||"",o.name=t.name||"",o.description=t.documentation||"",o.type=t.$type||"",o.type==="bpmn:UserTask"?o.user=t.get("flowable:assignee"):o.condition="",o.type==="bpmn:SequenceFlow"?o.condition=((e=t.conditionExpression)==null?void 0:e.body)||"":o.condition=""},C=t=>{w(d.value).get("modeling").updateProperties(w(a.value),t)},f=(t,e)=>{if(!a.value)return;let u={};u[e]=t,a.value[e]=t,C(u)},X=t=>{if(console.log(t),!a.value)return;const e=w(d.value).get("modeling"),m=w(d.value).get("moddle").create("bpmn:FormalExpression",{body:t});e.updateProperties(a.value,{conditionExpression:m})};return(t,e)=>{const u=Z,m=H,p=z,L=A,R=K,U=G;return v(),j(O,null,[g("div",{class:"container",ref_key:"canvasRef",ref:y},null,512),e[9]||(e[9]=g("div",{id:"js-properties-panel"},null,-1)),g("div",ee,[s(u,{type:"primary",onClick:D},{default:i(()=>e[8]||(e[8]=[E("保存")])),_:1})]),s(U,{class:"panelCard"},{header:i(()=>[g("div",te,[g("span",null,M(l(x)),1)])]),default:i(()=>[s(R,{model:l(o),"label-width":"auto"},{default:i(()=>[s(p,{label:"标识"},{default:i(()=>[s(m,{modelValue:l(o).key,"onUpdate:modelValue":e[0]||(e[0]=n=>l(o).key=n),placeholder:"请输入标识",onChange:e[1]||(e[1]=n=>f(n,"id"))},null,8,["modelValue"])]),_:1}),s(p,{label:"类型"},{default:i(()=>[s(L,{class:"mx-1"},{default:i(()=>[E(M(l(o).type),1)]),_:1})]),_:1}),s(p,{label:"名称"},{default:i(()=>[s(m,{modelValue:l(o).name,"onUpdate:modelValue":e[2]||(e[2]=n=>l(o).name=n),placeholder:"请输入名称",onChange:e[3]||(e[3]=n=>f(n,"name"))},null,8,["modelValue"])]),_:1}),s(p,{label:"描述"},{default:i(()=>[s(m,{modelValue:l(o).description,"onUpdate:modelValue":e[4]||(e[4]=n=>l(o).description=n),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),l(o).type==="bpmn:UserTask"?(v(),h(p,{key:0,label:"用户"},{default:i(()=>[s(m,{modelValue:l(o).user,"onUpdate:modelValue":e[5]||(e[5]=n=>l(o).user=n),placeholder:"请输入用户",onChange:e[6]||(e[6]=n=>f(n,"flowable:assignee"))},null,8,["modelValue"])]),_:1})):P("",!0),l(o).type==="bpmn:SequenceFlow"?(v(),h(p,{key:1,label:"流条件"},{default:i(()=>[s(m,{modelValue:l(o).condition,"onUpdate:modelValue":e[7]||(e[7]=n=>l(o).condition=n),placeholder:"请输入用户",onChange:X},null,8,["modelValue"])]),_:1})):P("",!0)]),_:1},8,["model"])]),_:1})],64)}}},me=J(oe,[["__scopeId","data-v-a7bcd42a"]]);export{me as default};
